<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Tic Tac Toe</title>
<style>
body{
    font-family:Arial,Helvetica,sans-serif;
    background:#111;
    color:white;
    text-align:center;
}
h1{margin-top:20px;}
button{
    padding:10px 20px;
    margin:8px;
    font-size:16px;
    cursor:pointer;
}
#menu{
    margin-top:40px;
}
#game{
    display:none;
}
#status{
    margin:10px;
    font-size:20px;
}
.big-board{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
    width:600px;
    margin:20px auto;
}
.mini-board{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    background:#333;
    position:relative;
    aspect-ratio:1/1;
    border:3px solid #666;
}
.mini-board.active{
    border:3px solid yellow;
}
.cell{
    border:1px solid #555;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:32px;
    cursor:pointer;
    user-select:none;
}
.cell:hover{
    background:#444;
}
.claimed{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:80px;
    background:rgba(0,0,0,0.8);
}
#leaderboard{
    margin-top:20px;
}
.score{
    font-size:18px;
    margin:4px;
}
</style>
</head>
<body>

<h1>Ultimate Tic Tac Toe</h1>

<div id="menu">
    <h2>Select Mode</h2>
    <button onclick="startGame('pvp')">Player vs Player</button>
    <button onclick="startGame('easy')">Easy AI</button>
    <button onclick="startGame('medium')">Medium AI</button>
    <button onclick="startGame('hard')">Hard AI</button>

    <div id="leaderboard">
        <h2>AI Leaderboard (Your Wins)</h2>
        <div class="score">Easy: <span id="easyScore">0</span></div>
        <div class="score">Medium: <span id="mediumScore">0</span></div>
        <div class="score">Hard: <span id="hardScore">0</span></div>
        <button onclick="resetScores()">Reset Leaderboard</button>
    </div>
</div>

<div id="game">
    <div id="status"></div>
    <button onclick="resetGame()">Restart</button>
    <button onclick="backToMenu()">Back To Menu</button>
    <div class="big-board" id="bigBoard"></div>
</div>

<script>
const bigBoard=document.getElementById("bigBoard");
const statusDiv=document.getElementById("status");
const menu=document.getElementById("menu");
const gameDiv=document.getElementById("game");

let currentPlayer="X";
let activeMini=null;
let gameOver=false;
let miniBoards=[];
let bigBoardState=[];
let mode="pvp";

let scores={
    easy:parseInt(localStorage.getItem("easyWins"))||0,
    medium:parseInt(localStorage.getItem("mediumWins"))||0,
    hard:parseInt(localStorage.getItem("hardWins"))||0
};

updateLeaderboard();

function updateLeaderboard(){
    document.getElementById("easyScore").textContent=scores.easy;
    document.getElementById("mediumScore").textContent=scores.medium;
    document.getElementById("hardScore").textContent=scores.hard;
}

function saveScores(){
    localStorage.setItem("easyWins",scores.easy);
    localStorage.setItem("mediumWins",scores.medium);
    localStorage.setItem("hardWins",scores.hard);
}

function resetScores(){
    scores.easy=0;
    scores.medium=0;
    scores.hard=0;
    saveScores();
    updateLeaderboard();
}

function startGame(selectedMode){
    mode=selectedMode;
    menu.style.display="none";
    gameDiv.style.display="block";
    createBoard();
}

function backToMenu(){
    gameDiv.style.display="none";
    menu.style.display="block";
}

function createBoard(){
    bigBoard.innerHTML="";
    miniBoards=[];
    bigBoardState=Array(9).fill(null);
    currentPlayer="X";
    activeMini=null;
    gameOver=false;
    statusDiv.textContent="Current Player: X";

    for(let i=0;i<9;i++){
        const mini=document.createElement("div");
        mini.classList.add("mini-board");
        mini.dataset.index=i;
        const miniState=Array(9).fill(null);
        miniBoards.push(miniState);

        for(let j=0;j<9;j++){
            const cell=document.createElement("div");
            cell.classList.add("cell");
            cell.dataset.mini=i;
            cell.dataset.cell=j;
            cell.addEventListener("click",handleMove);
            mini.appendChild(cell);
        }
        bigBoard.appendChild(mini);
    }
    updateActiveBoards();
}

function handleMove(e){
    if(gameOver) return;

    const miniIndex=parseInt(e.target.dataset.mini);
    const cellIndex=parseInt(e.target.dataset.cell);

    if(activeMini!==null && miniIndex!==activeMini) return;
    if(miniBoards[miniIndex][cellIndex]!==null) return;
    if(bigBoardState[miniIndex]!==null) return;

    makeMove(miniIndex,cellIndex,currentPlayer);

    if(!gameOver){
        currentPlayer=currentPlayer==="X"?"O":"X";
        statusDiv.textContent="Current Player: "+currentPlayer;
        updateActiveBoards();

        if(mode!=="pvp" && currentPlayer==="O"){
            setTimeout(aiMove,300);
        }
    }
}

function makeMove(miniIndex,cellIndex,player){
    miniBoards[miniIndex][cellIndex]=player;
    const mini=bigBoard.children[miniIndex];
    mini.children[cellIndex].textContent=player;

    if(checkWin(miniBoards[miniIndex])){
        claimMiniBoard(miniIndex,player);
    }

    if(checkWin(bigBoardState)){
        statusDiv.textContent=player+" wins the game!";
        gameOver=true;

        if(player==="X" && mode!=="pvp"){
            scores[mode]++;
            saveScores();
            updateLeaderboard();
        }
        return;
    }

    if(bigBoardState[cellIndex]===null && !isMiniFull(cellIndex)){
        activeMini=cellIndex;
    }else{
        activeMini=null;
    }
}

function claimMiniBoard(index,player){
    bigBoardState[index]=player;
    const mini=bigBoard.children[index];
    const overlay=document.createElement("div");
    overlay.classList.add("claimed");
    overlay.textContent=player;
    mini.appendChild(overlay);
}

function checkWin(board){
    const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return wins.some(combo=>combo.every(i=>board[i] && board[i]===board[combo[0]]));
}

function isMiniFull(index){
    return miniBoards[index].every(cell=>cell!==null);
}

function updateActiveBoards(){
    const minis=document.querySelectorAll(".mini-board");
    minis.forEach((mini,i)=>{
        mini.classList.remove("active");
        if(activeMini===null){
            if(bigBoardState[i]===null && !isMiniFull(i)){
                mini.classList.add("active");
            }
        }else if(i===activeMini){
            mini.classList.add("active");
        }
    });
}

function aiMove(){
    if(gameOver) return;

    let move;
    if(mode==="easy") move=randomMove();
    else if(mode==="medium") move=mediumMove();
    else move=mediumMove();

    if(move){
        makeMove(move.mini,move.cell,"O");
        if(!gameOver){
            currentPlayer="X";
            statusDiv.textContent="Current Player: X";
            updateActiveBoards();
        }
    }
}

function getAvailableMoves(){
    const moves=[];
    for(let i=0;i<9;i++){
        if(activeMini!==null && i!==activeMini) continue;
        if(bigBoardState[i]!==null) continue;
        for(let j=0;j<9;j++){
            if(miniBoards[i][j]===null){
                moves.push({mini:i,cell:j});
            }
        }
    }
    return moves;
}

function randomMove(){
    const moves=getAvailableMoves();
    return moves[Math.floor(Math.random()*moves.length)];
}

function mediumMove(){
    const moves=getAvailableMoves();
    for(const m of moves){
        miniBoards[m.mini][m.cell]="O";
        if(checkWin(miniBoards[m.mini])){
            miniBoards[m.mini][m.cell]=null;
            return m;
        }
        miniBoards[m.mini][m.cell]=null;
    }
    for(const m of moves){
        miniBoards[m.mini][m.cell]="X";
        if(checkWin(miniBoards[m.mini])){
            miniBoards[m.mini][m.cell]=null;
            return m;
        }
        miniBoards[m.mini][m.cell]=null;
    }
    return randomMove();
}

function resetGame(){
    createBoard();
}
</script>

</body>
</html>